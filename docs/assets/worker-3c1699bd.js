var De=Object.defineProperty;var ve=(b,h,s)=>h in b?De(b,h,{enumerable:!0,configurable:!0,writable:!0,value:s}):b[h]=s;var C=(b,h,s)=>(ve(b,typeof h!="symbol"?h+"":h,s),s);(function(){"use strict";var b=""+new URL("RaverieEditor-6d38bfe1.wasm",self.location.href).href,h=(r=>(r[r.Unknown=0]="Unknown",r[r.A="A".charCodeAt(0)]="A",r[r.B="B".charCodeAt(0)]="B",r[r.C="C".charCodeAt(0)]="C",r[r.D="D".charCodeAt(0)]="D",r[r.E="E".charCodeAt(0)]="E",r[r.F="F".charCodeAt(0)]="F",r[r.G="G".charCodeAt(0)]="G",r[r.H="H".charCodeAt(0)]="H",r[r.I="I".charCodeAt(0)]="I",r[r.J="J".charCodeAt(0)]="J",r[r.K="K".charCodeAt(0)]="K",r[r.L="L".charCodeAt(0)]="L",r[r.M="M".charCodeAt(0)]="M",r[r.N="N".charCodeAt(0)]="N",r[r.O="O".charCodeAt(0)]="O",r[r.P="P".charCodeAt(0)]="P",r[r.Q="Q".charCodeAt(0)]="Q",r[r.R="R".charCodeAt(0)]="R",r[r.S="S".charCodeAt(0)]="S",r[r.T="T".charCodeAt(0)]="T",r[r.U="U".charCodeAt(0)]="U",r[r.V="V".charCodeAt(0)]="V",r[r.W="W".charCodeAt(0)]="W",r[r.Y="Y".charCodeAt(0)]="Y",r[r.X="X".charCodeAt(0)]="X",r[r.Z="Z".charCodeAt(0)]="Z",r[r.Space=" ".charCodeAt(0)]="Space",r[r.Num0="0".charCodeAt(0)]="Num0",r[r.Num1="1".charCodeAt(0)]="Num1",r[r.Num2="2".charCodeAt(0)]="Num2",r[r.Num3="3".charCodeAt(0)]="Num3",r[r.Num4="4".charCodeAt(0)]="Num4",r[r.Num5="5".charCodeAt(0)]="Num5",r[r.Num6="6".charCodeAt(0)]="Num6",r[r.Num7="7".charCodeAt(0)]="Num7",r[r.Num8="8".charCodeAt(0)]="Num8",r[r.Num9="9".charCodeAt(0)]="Num9",r[r.LeftBracket="[".charCodeAt(0)]="LeftBracket",r[r.RightBracket="]".charCodeAt(0)]="RightBracket",r[r.Comma=".charCodeAt(0),".charCodeAt(0)]="Comma",r[r.Period=".".charCodeAt(0)]="Period",r[r.Semicolon=";".charCodeAt(0)]="Semicolon",r[r.Minus="-".charCodeAt(0)]="Minus",r[r.Apostrophe="'".charCodeAt(0)]="Apostrophe",r[r.Slash="/".charCodeAt(0)]="Slash",r[r.Backslash="\\".charCodeAt(0)]="Backslash",r[r.Up=128]="Up",r[r.Down=129]="Down",r[r.Left=130]="Left",r[r.Right=131]="Right",r[r.F1=132]="F1",r[r.F2=133]="F2",r[r.F3=134]="F3",r[r.F4=135]="F4",r[r.F5=136]="F5",r[r.F6=137]="F6",r[r.F7=138]="F7",r[r.F8=139]="F8",r[r.F9=140]="F9",r[r.F10=141]="F10",r[r.F11=142]="F11",r[r.F12=143]="F12",r[r.Insert=144]="Insert",r[r.Delete=145]="Delete",r[r.Back=146]="Back",r[r.Home=147]="Home",r[r.End=148]="End",r[r.Tilde=149]="Tilde",r[r.Tab=150]="Tab",r[r.Shift=151]="Shift",r[r.Alt=152]="Alt",r[r.Control=153]="Control",r[r.Capital=154]="Capital",r[r.Enter=155]="Enter",r[r.Escape=156]="Escape",r[r.PageUp=157]="PageUp",r[r.PageDown=158]="PageDown",r[r.Equal=159]="Equal",r[r.NumPad0=160]="NumPad0",r[r.NumPad1=161]="NumPad1",r[r.NumPad2=162]="NumPad2",r[r.NumPad3=163]="NumPad3",r[r.NumPad4=164]="NumPad4",r[r.NumPad5=165]="NumPad5",r[r.NumPad6=166]="NumPad6",r[r.NumPad7=167]="NumPad7",r[r.NumPad8=168]="NumPad8",r[r.NumPad9=169]="NumPad9",r[r.Add=170]="Add",r[r.Multiply=171]="Multiply",r[r.Subtract=172]="Subtract",r[r.Divide=173]="Divide",r[r.Decimal=174]="Decimal",r))(h||{}),s=(r=>(r[r.SampleRate=44100]="SampleRate",r[r.Channels=2]="Channels",r))(s||{});const d=r=>{postMessage(r)},Q=WebAssembly.compileStreaming(fetch(b)),J=async r=>{var j,$;const w=[],R=e=>{w.push(e)};addEventListener("message",R);const Z=await Q,a=r.canvas.getContext("webgl2",{antialias:!1,alpha:!1,preserveDrawingBuffer:!1}),y=a.getExtension("EXT_texture_filter_anisotropic"),K=34046,M=e=>{if(!a.getExtension(e))throw new Error(`Needs ${e} to function`)};M("EXT_color_buffer_float"),M("OES_texture_float_linear");class x{constructor(){C(this,"map",{});C(this,"counter",1)}allocate(t){if(!t)throw new Error("Failed to allocate type");const o=this.counter++;return this.map[o]=t,o}delete(t){if(t===0)return null;const o=this.map[t];if(!o)throw new Error(`Double delete or attempt to delete invalid id: ${t}`);return delete this.map[t],o}get(t){return t===0?null:this.getRequired(t)}getRequired(t){const o=this.map[t];if(!o)throw new Error("Attempt to get value by invalid id");return o}}class ee{constructor(){C(this,"mapToId",new Map);C(this,"mapToValue",{});C(this,"counter",0)}allocateOrGet(t){if(!t)return-1;let o=this.mapToId.get(t);return o===void 0&&(o=this.counter++,this.mapToId.set(t,o),this.mapToValue[o]=t),o}clear(){this.mapToId.clear(),this.mapToValue={}}get(t){if(t===-1)return null;const o=this.mapToValue[t];if(!o)throw new Error("Attempt to get value by invalid id");return o}}const v=new x,P=new x,T=new x,I=new x,A=new x,F=new x,te=new x;let u=null,B=!1;const re={env:{ImportGlActiveTexture:e=>{a.activeTexture(e)},ImportGlAttachShader:(e,t)=>{a.attachShader(I.getRequired(e),A.getRequired(t))},ImportGlBindAttribLocation:(e,t,o)=>{const n=g(o);a.bindAttribLocation(I.getRequired(e),t,n)},ImportGlBindBuffer:(e,t)=>{a.bindBuffer(e,P.get(t))},ImportGlBindFramebuffer:(e,t)=>{a.bindFramebuffer(e,T.get(t))},ImportGlBindSampler:(e,t)=>{a.bindSampler(e,te.get(t))},ImportGlBindTexture:(e,t)=>{a.bindTexture(e,F.get(t))},ImportGlBindVertexArray:e=>{a.bindVertexArray(v.get(e))},ImportGlBlendEquation:e=>{a.blendEquation(e)},ImportGlBlendEquationi:(e,t)=>{throw new Error("Not implemented")},ImportGlBlendEquationSeparate:(e,t)=>{a.blendEquationSeparate(e,t)},ImportGlBlendEquationSeparatei:(e,t,o)=>{throw new Error("Not implemented")},ImportGlBlendFunc:(e,t)=>{a.blendFunc(e,t)},ImportGlBlendFunci:(e,t,o)=>{throw new Error("Not implemented")},ImportGlBlendFuncSeparate:(e,t,o,n)=>{a.blendFuncSeparate(e,t,o,n)},ImportGlBlendFuncSeparatei:(e,t,o,n,l)=>{throw new Error("Not implemented")},ImportGlBlitFramebuffer:(e,t,o,n,l,i,m,f,E,Fe)=>{a.blitFramebuffer(e,t,o,n,l,i,m,f,E,Fe)},ImportGlBufferData:(e,t,o,n)=>{const l=new DataView(p.buffer,o,t);a.bufferData(e,l,n)},ImportGlBufferSubData:(e,t,o,n)=>{const l=new DataView(p.buffer,n,o);a.bufferSubData(e,t,l)},ImportGlCheckFramebufferStatus:e=>a.checkFramebufferStatus(e),ImportGlClear:e=>{a.clear(e)},ImportGlClearColor:(e,t,o,n)=>{a.clearColor(e,t,o,n)},ImportGlClearDepth:e=>{a.clearDepth(e)},ImportGlClearStencil:e=>{a.clearStencil(e)},ImportGlCompileShader:e=>{a.compileShader(A.getRequired(e))},ImportGlCompressedTexImage2D:(e,t,o,n,l,i,m)=>{throw new Error("Not implemented")},ImportGlCreateProgram:()=>{const e=a.createProgram();return e.locations=new ee,I.allocate(e)},ImportGlCreateShader:e=>A.allocate(a.createShader(e)),ImportGlCullFace:e=>{a.cullFace(e)},ImportGlDeleteBuffer:e=>{a.deleteBuffer(P.delete(e))},ImportGlDeleteFramebuffer:e=>{a.deleteFramebuffer(T.delete(e))},ImportGlDeleteProgram:e=>{const t=I.delete(e);t&&(a.deleteProgram(t),t.locations.clear(),delete t.locations)},ImportGlDeleteSamplers:(e,t)=>{throw new Error("Not implemented")},ImportGlDeleteShader:e=>{a.deleteShader(A.delete(e))},ImportGlDeleteTexture:e=>{a.deleteTexture(F.delete(e))},ImportGlDeleteVertexArray:e=>{a.deleteVertexArray(v.delete(e))},ImportGlDepthFunc:e=>{a.depthFunc(e)},ImportGlDepthMask:e=>{a.depthMask(e)},ImportGlDetachShader:(e,t)=>{a.detachShader(I.getRequired(e),A.getRequired(t))},ImportGlDisable:e=>{a.disable(e)},ImportGlDisablei:(e,t)=>{throw new Error("Not implemented")},ImportGlDrawArrays:(e,t,o)=>{a.drawArrays(e,t,o)},ImportGlDrawBuffers:(e,t)=>{a.drawBuffers(new Uint32Array(p.buffer,t,e))},ImportGlDrawElements:(e,t,o,n)=>{a.drawElements(e,t,o,n)},ImportGlEnable:e=>{a.enable(e)},ImportGlEnablei:(e,t)=>{throw new Error("Not implemented")},ImportGlEnableVertexAttribArray:e=>{a.enableVertexAttribArray(e)},ImportGlFramebufferTexture2D:(e,t,o,n,l)=>{a.framebufferTexture2D(e,t,o,F.get(n),l)},ImportGlGenBuffer:()=>P.allocate(a.createBuffer()),ImportGlGenerateMipmap:e=>{a.generateMipmap(e)},ImportGlGenFramebuffer:()=>T.allocate(a.createFramebuffer()),ImportGlGenSamplers:(e,t)=>{throw new Error("Not implemented")},ImportGlGenTexture:()=>F.allocate(a.createTexture()),ImportGlGenVertexArray:()=>v.allocate(a.createVertexArray()),ImportGlGetProgramInfoLog:(e,t,o,n)=>{throw new Error("Not implemented")},ImportGlGetProgramiv:(e,t,o)=>{throw new Error("Not implemented")},ImportGlGetShaderInfoLog:(e,t,o,n)=>{throw new Error("Not implemented")},ImportGlGetShaderiv:(e,t,o)=>{throw new Error("Not implemented")},ImportGlGetUniformLocation:(e,t)=>{const o=I.getRequired(e),n=g(t),l=a.getUniformLocation(o,n);return o.locations.allocateOrGet(l)},ImportGlLineWidth:e=>{a.lineWidth(Math.max(e,1e-7))},ImportGlLinkProgram:e=>{const t=I.getRequired(e);t.locations.clear(),a.linkProgram(t)},ImportGlPixelStorei:(e,t)=>{a.pixelStorei(e,t)},ImportGlReadPixels:(e,t,o,n,l,i,m)=>{a.readPixels(e,t,o,n,l,i,O(o,n,l,i,m))},ImportGlSamplerParameteri:(e,t,o)=>{throw new Error("Not implemented")},ImportGlScissor:(e,t,o,n)=>{a.scissor(e,t,o,n)},ImportGlShaderSource:(e,t,o)=>{const n=X(t,o);a.shaderSource(A.getRequired(e),n)},ImportGlStencilFunc:(e,t,o)=>{a.stencilFunc(e,t,o)},ImportGlStencilFuncSeparate:(e,t,o,n)=>{a.stencilFuncSeparate(e,t,o,n)},ImportGlStencilMask:e=>{a.stencilMask(e)},ImportGlStencilMaskSeparate:(e,t)=>{a.stencilMaskSeparate(e,t)},ImportGlStencilOp:(e,t,o)=>{a.stencilOp(e,t,o)},ImportGlStencilOpSeparate:(e,t,o,n)=>{a.stencilOpSeparate(e,t,o,n)},ImportGlTexImage2D:(e,t,o,n,l,i,m,f)=>{a.texImage2D(e,t,o,n,l,0,i,m,O(n,l,i,m,f))},ImportGlTexParameterf:(e,t,o)=>{t===K?y&&a.texParameterf(e,t,o):a.texParameterf(e,t,o)},ImportGlTexParameteri:(e,t,o)=>{a.texParameteri(e,t,o)},ImportGlTexSubImage2D:(e,t,o,n,l,i,m,f,E)=>{a.texSubImage2D(e,t,o,n,l,i,m,f,O(l,i,m,f,E))},ImportGlUniform1fv:(e,t,o)=>{a.uniform1fv(u.locations.get(e),new Float32Array(p.buffer,o,t))},ImportGlUniform1iv:(e,t,o)=>{a.uniform1iv(u.locations.get(e),new Int32Array(p.buffer,o,t))},ImportGlUniform2fv:(e,t,o)=>{a.uniform2fv(u.locations.get(e),new Float32Array(p.buffer,o,t*2))},ImportGlUniform2iv:(e,t,o)=>{a.uniform2iv(u.locations.get(e),new Int32Array(p.buffer,o,t*2))},ImportGlUniform3fv:(e,t,o)=>{a.uniform3fv(u.locations.get(e),new Float32Array(p.buffer,o,t*3))},ImportGlUniform3iv:(e,t,o)=>{a.uniform3iv(u.locations.get(e),new Int32Array(p.buffer,o,t*3))},ImportGlUniform4fv:(e,t,o)=>{a.uniform4fv(u.locations.get(e),new Float32Array(p.buffer,o,t*4))},ImportGlUniform4iv:(e,t,o)=>{a.uniform4iv(u.locations.get(e),new Int32Array(p.buffer,o,t*4))},ImportGlUniformMatrix3fv:(e,t,o,n)=>{a.uniformMatrix3fv(u.locations.get(e),o,new Float32Array(p.buffer,n,t*3*3))},ImportGlUniformMatrix4fv:(e,t,o,n)=>{a.uniformMatrix4fv(u.locations.get(e),o,new Float32Array(p.buffer,n,t*4*4))},ImportGlUseProgram:e=>{const t=I.get(e);u=t,a.useProgram(t)},ImportGlVertexAttribIPointer:(e,t,o,n,l)=>{a.vertexAttribIPointer(e,t,o,n,l)},ImportGlVertexAttribPointer:(e,t,o,n,l,i)=>{a.vertexAttribPointer(e,t,o,n,l,i)},ImportGlViewport:(e,t,o,n)=>{a.viewport(e,t,o,n)},ImportPrintLine:(e,t,o)=>{const i=X(t,o);switch(e){case 1:console.log(i);break;case 2:console.error(i);break;default:throw new Error(`Invalid fd: ${e}`)}},ImportClock:e=>{switch(e){case 0:return Date.now()*1e6;case 1:return performance.now()*1e6;default:throw new Error(`Invalid clockId: ${e}`)}},ImportYield:()=>{const e=a.drawingBufferWidth,t=a.drawingBufferHeight,o=new Uint8ClampedArray(e*t*4);a.readPixels(0,0,e,t,a.RGBA,a.UNSIGNED_BYTE,o);const n=Math.floor(t/2),l=e*4,i=new Uint8ClampedArray(e*4);for(let m=0;m<n;++m){const f=m*l,E=(t-m-1)*l;i.set(o.subarray(f,f+l)),o.copyWithin(f,E,E+l),o.set(i,E)}d({type:"yieldDraw",pixels:o,width:e,height:t}),B=!0},ImportMouseTrap:e=>{d({type:"mouseTrap",value:!!e})},ImportMouseSetCursor:e=>{d({type:"mouseSetCursor",cursor:e})},ImportDownloadFile:(e,t,o)=>{const n=g(e),l=D(t,o);d({type:"downloadFile",filename:n,buffer:l})},ImportRandomUnique:()=>{const e=new Uint8Array(8);return crypto.getRandomValues(e),new DataView(e.buffer).getBigUint64(0)},ImportOpenFileDialog:(e,t,o)=>{d({type:"openFileDialog",dialog:e,multiple:!!t,accept:g(o)})},ImportProgressUpdate:(e,t)=>{d({type:"progressUpdate",text:e===0?null:g(e),percent:t})},ImportSaveProject:(e,t,o,n,l)=>{d({type:"projectSave",name:g(e),projectArchive:D(t,o),builtContentArchive:D(n,l)})},ImportOpenUrl:e=>{d({type:"openUrl",url:g(e)})},ImportGamepadVibrate:(e,t,o)=>{d({type:"gamepadVibrate",gamepadIndex:e,duration:t,intensity:o})}}},c=await WebAssembly.instantiate(Z,re),p=c.exports.memory,oe=c.exports.ExportAllocate,G=c.exports.ExportFree,ae=c.exports.ExportInitialize,k=c.exports.ExportRunIteration,ne=c.exports.ExportHandleCrash,le=c.exports.ExportMouseMove,ie=c.exports.ExportMouseScroll,ce=c.exports.ExportMouseButtonChanged,pe=c.exports.ExportTextTyped,me=c.exports.ExportKeyboardButtonChanged;c.exports.ExportQuit;const de=c.exports.ExportCopy,ue=c.exports.ExportPaste,V=c.exports.ExportFileCreate;c.exports.ExportFileDelete;const fe=c.exports.ExportFileDropAdd,he=c.exports.ExportFileDropFinish,se=c.exports.ExportOpenFileDialogAdd,Ie=c.exports.ExportOpenFileDialogFinish,ge=c.exports.ExportSizeChanged,be=c.exports.ExportFocusChanged,xe=c.exports.ExportGamepadConnectionChanged,Ee=c.exports.ExportGamepadButtonChanged,Ae=c.exports.ExportGamepadAxisChanged,Ce=c.exports.ExportAudioOutput,we=e=>{r.audioPort.postMessage(e)};r.audioPort.onmessage=e=>{const t=e.data,o=Ce(t.framesRequested);we({type:"audioOutput",id:t.id,samplesPerChannel:new Float32Array(D(o,t.framesRequested*4*s.Channels))})};const S=e=>{if(!e)return 0;const t=oe(e.byteLength);return new Uint8Array(p.buffer).set(e,t),t},N=e=>S(Ge.encode(`${e}\0`)),L=e=>{const t=e.data;switch(t.type){case"mouseMove":le(t.clientX,t.clientY,t.dx,t.dy);break;case"mouseScroll":ie(t.clientX,t.clientY,t.scrollX,t.scrollY);break;case"mouseButtonChanged":ce(t.clientX,t.clientY,t.button,t.state);break;case"keyboardButtonChanged":me(t.button,t.state);break;case"textTyped":pe(t.rune);break;case"copy":d({type:"copyData",text:g(de(Number(t.isCut)))});break;case"paste":{const o=N(t.text);ue(o),G(o);break}case"filesDropped":{for(const o of t.files){const n=N(`/tmp/${o.fileName}`),l=S(new Uint8Array(o.buffer));V(n,l,o.buffer.byteLength),fe(n),G(n)}he(t.clientX,t.clientY);break}case"openFileDialogFinish":{for(const o of t.files){const n=N(`/tmp/${o.fileName}`),l=S(new Uint8Array(o.buffer));V(n,l,o.buffer.byteLength),se(t.dialog,n),G(n)}Ie(t.dialog);break}case"sizeChanged":r.canvas.width=t.clientWidth,r.canvas.height=t.clientHeight,ge(t.clientWidth,t.clientHeight),k();break;case"focusChanged":be(Number(t.focused));break;case"gamepadConnectionChanged":{const o=N(t.id);xe(t.gamepadIndex,o,Number(t.connected)),G(o);break}case"gamepadButtonChanged":Ee(t.gamepadIndex,t.buttonIndex,Number(t.pressed),Number(t.touched),t.value);break;case"gamepadAxisChanged":Ae(t.gamepadIndex,t.axisIndex,t.value);break}};let q=-1;const H=()=>{cancelAnimationFrame(q),removeEventListener("message",L),ne()};addEventListener("error",H),addEventListener("unhandledrejection",H);const W=new TextDecoder,Ge=new TextEncoder,X=(e,t)=>W.decode(new DataView(p.buffer,e,t)),g=e=>{const t=new Uint8Array(p.buffer);let o=0;for(let n=e;n<t.byteLength;++n)if(t[n]===0){o=n-e;break}return W.decode(new DataView(p.buffer,e,o))},D=(e,t)=>p.buffer.slice(e,e+t),O=(e,t,o,n,l)=>{if(l===0)return null;let i=0;switch(o){case a.DEPTH_COMPONENT:i=1;break;case a.DEPTH_STENCIL:i=1;break;case a.RED:i=1;break;case a.RG:i=2;break;case a.RGB:i=3;break;case a.RGBA:i=4;break;default:throw new Error(`Unhandled format ${o}`)}const m=i*e*t;switch(n){case a.UNSIGNED_BYTE:return new Uint8Array(p.buffer,l,m);case a.UNSIGNED_SHORT_5_6_5:case a.UNSIGNED_SHORT_4_4_4_4:case a.UNSIGNED_SHORT_5_5_5_1:case a.UNSIGNED_SHORT:case a.HALF_FLOAT:return new Uint16Array(p.buffer,l,m);case a.UNSIGNED_INT:case a.UNSIGNED_INT_24_8:return new Uint32Array(p.buffer,l,m);case a.FLOAT:return new Float32Array(p.buffer,l,m);default:throw new Error(`Unhandled type ${n}`)}},Y=N(r.args),Se=S(r.projectArchive),Ne=S(r.builtContentArchive);ae(Y,r.canvas.width,r.canvas.height,Number(r.focused),Se,((j=r.projectArchive)==null?void 0:j.byteLength)||0,Ne,(($=r.builtContentArchive)==null?void 0:$.byteLength)||0),G(Y),removeEventListener("message",R),addEventListener("message",L);for(const e of w)L(e);let U=!1;const z=()=>{q=requestAnimationFrame(z),k(),B?(B=!1,U=!0):U&&(U=!1,d({type:"yieldComplete"}))};z()},_=r=>{const w=r.data;w.type==="initialize"&&(removeEventListener("message",_),J(w))};addEventListener("message",_)})();
